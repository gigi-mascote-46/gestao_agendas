{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="d-flex align-items-center justify-content-center animate-fade-in" style="min-height: 85vh; padding: 20px;">

    <div class="login-card shadow-lg">
        
        <div class="text-center mb-4">
            <i class="fa-solid fa-user-gear fa-3x text-success mb-3" style="filter: drop-shadow(0 0 15px var(--neon-green));"></i>
            <h2 class="text-uppercase fw-bold" style="text-shadow: 0 0 10px var(--neon-green); letter-spacing: 2px;">
                Solicitar Acesso
            </h2>
        </div>

        <div class="alert bg-dark border-warning text-warning mb-4 shadow-sm" style="border-radius: 12px; font-size: 0.85rem; border-left: 4px solid #ffc107;">
            <i class="fa-solid fa-shield-halved me-2"></i>
            <strong>SECURITY NOTE:</strong> A tua conta será criada como <span class="text-decoration-underline">inativa</span> até ser validada pelo Chef no Dashboard.
        </div>

        <form method="post" autocomplete="off">
            {% csrf_token %}

            {% for field in form %}
            <div class="mb-3 text-start">
                <label for="{{ field.id_for_label }}" class="form-label text-info small fw-bold ms-1 text-uppercase" style="font-size: 0.7rem;">
                    <i class="fa-solid fa-caret-right me-1"></i> {{ field.label }}
                </label>

                {% if field.name == "is_chef" %}
                    <div class="form-check form-switch p-3 border border-secondary rounded-4 bg-black bg-opacity-25 d-flex align-items-center">
                        {{ field }}
                        <label class="form-check-label text-muted ms-3" for="{{ field.id_for_label }}">Solicitar privilégios de Gestor</label>
                    </div>
                {% else %}
                    <div class="input-group flex-nowrap">
                        <span class="input-group-text bg-transparent border-info text-info">
                            {% if "username" in field.name %}<i class="fa-solid fa-id-card-clip"></i>
                            {% elif "email" in field.name %}<i class="fa-solid fa-at"></i>
                            {% elif "password" in field.name %}<i class="fa-solid fa-user-lock"></i>
                            {% elif "departamento" in field.name %}<i class="fa-solid fa-network-wired"></i>
                            {% else %}<i class="fa-solid fa-terminal"></i>{% endif %}
                        </span>
                        {{ field }}
                    </div>
                {% endif %}

                {% if field.help_text %}
                    <div class="helptext mt-1 ps-2">{{ field.help_text|safe }}</div>
                {% endif %}

                {% if field.errors %}
                    <div class="text-danger mt-1 ps-2 fw-bold animate-pulse" style="font-size: 0.75rem;">
                        <i class="fa-solid fa-triangle-exclamation me-1"></i> {{ field.errors|striptags }}
                    </div>
                {% endif %}
            </div>
            {% endfor %}

            <button type="submit" class="btn btn-primary w-100 py-3 mt-3 text-uppercase fw-bold shadow">
                <i class="fa-solid fa-upload me-2"></i> Submeter Credenciais
            </button>
        </form>

        <div class="login-footer mt-4 border-top border-secondary pt-3 text-center">
            <p>Já tens conta? <a href="{% url 'login' %}" class="text-success fw-bold">Iniciar Sessão</a></p>
        </div>
    </div>
</div>

<style>
    /* CORREÇÃO DO ALINHAMENTO: Removemos a largura fixa e usamos o flex do Bootstrap */
    .input-group input, .input-group select {
        flex: 1 1 auto !important;
        width: 1% !important; /* Padrão do Bootstrap para alinhar no input-group */
        background: rgba(15, 23, 42, 0.6) !important;
        border: 1px solid rgba(0, 247, 255, 0.2) !important;
        border-left: none !important; /* Funde com o ícone */
        color: #fff !important;
        border-radius: 0 14px 14px 0 !important;
        padding: 12px 15px !important;
        transition: all 0.3s ease;
    }

    /* Estilização do Bloco do Ícone */
    .input-group-text {
        border: 1px solid rgba(0, 247, 255, 0.2) !important;
        border-right: none !important; /* Funde com o input */
        border-radius: 14px 0 0 14px !important;
        background: rgba(0, 247, 255, 0.05) !important;
        min-width: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Placeholder ciano suave */
    ::placeholder {
        color: rgba(0, 247, 255, 0.3) !important;
        font-style: italic;
    }

    /* Foco Neon */
    input:focus, select:focus {
        border-color: var(--neon-cyan) !important;
        box-shadow: 0 0 15px rgba(0, 247, 255, 0.4) !important;
        outline: none;
    }

    .helptext {
        display: block;
        font-size: 0.7rem;
        color: var(--text-muted);
        opacity: 0.7;
        font-family: 'Courier New', Courier, monospace;
    }
    
    /* Estilo para a checkbox 'is_chef' em modo switch */
    input[type="checkbox"] {
        width: 40px !important;
        height: 20px !important;
        cursor: pointer;
    }
</style>
{% endblock %}